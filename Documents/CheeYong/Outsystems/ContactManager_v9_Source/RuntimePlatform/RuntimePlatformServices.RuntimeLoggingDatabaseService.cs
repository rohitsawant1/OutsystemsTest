/* 
 This source code (the "Generated Software") is generated by the OutSystems Platform 
 and is licensed by OutSystems (http://www.outsystems.com) to You solely for testing and evaluation 
 purposes, unless You and OutSystems have executed a specific agreement covering the use terms and 
 conditions of the Generated Software, in which case such agreement shall apply. 
*/

using OutSystems.Internal.Db;
using OutSystems.Logging;
using OutSystems.Logging.LogDefinition;
using OutSystems.RuntimeCommon;

namespace OutSystems.HubEdition.RuntimePlatform {

    public static partial class RuntimePlatformServices {

        internal class RuntimeLoggingDatabaseService : ILoggingDatabaseService {
            private static readonly RuntimeLoggingDatabaseService instance = new RuntimeLoggingDatabaseService();

            public static RuntimeLoggingDatabaseService Instance {
                get { return instance; }
            }

            public IDatabaseAccessProvider GetProviderFor(ICustomLogInformation logInfo) {
                if (!logInfo.DbConnection.IsEmpty()) {
                    return DatabaseAccess.ForDBConnection(logInfo.DbConnection);
                }
                var businessDatabaseProvider = DatabaseAccess.ForRuntimeDatabase;
                if (businessDatabaseProvider.DatabaseServices.DatabaseConfiguration.DatabaseIdentifier == logInfo.DbCatalog) {
                    return businessDatabaseProvider;
                }
                return DatabaseAccess.ForDatabase(logInfo.DbCatalog);
            }

            public IDatabaseAccessProvider GetProviderForLogging() {
                return DatabaseAccess.ForLogging;
            }
        }
    }
}
