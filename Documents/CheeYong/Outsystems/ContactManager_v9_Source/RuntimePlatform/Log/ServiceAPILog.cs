/* 
 This source code (the "Generated Software") is generated by the OutSystems Platform 
 and is licensed by OutSystems (http://www.outsystems.com) to You solely for testing and evaluation 
 purposes, unless You and OutSystems have executed a specific agreement covering the use terms and 
 conditions of the Generated Software, in which case such agreement shall apply. 
*/

using System;
using OutSystems.Logging.LogDefinition;

namespace OutSystems.HubEdition.RuntimePlatform.Log {

    [Serializable]
    public class ServiceAPILog {

        public static string StaticWrite(IAppInfo appInfo, ISessionInfo sessionInfo, DateTime instant, string loginId, string errorId,
                                         string executedBy, string action, int duration, string source, string endpoint, string originalRequestKey) {

            ServiceAPILogDefinition logDef = new ServiceAPILogDefinition {
                Id = ServiceAPILogDefinition.GenerateLogId(),
                Instant = instant,
                SessionId = sessionInfo.SessionID,
                UserId = sessionInfo.UserId,
                LoginId = loginId,
                EspaceId = appInfo.eSpaceId,
                TenantId = appInfo.TenantId,
                ErrorId = errorId,
                ExecutedBy = executedBy,
                Action = action,
                Duration = duration,
                Source = source,
                Endpoint = endpoint,
                EspaceName = appInfo.eSpaceName,
                ApplicationName = appInfo.ApplicationName,
                ApplicationKey = appInfo.ApplicationUIDAsKey,
                Username = sessionInfo.UserName,
                OriginalRequestKey = originalRequestKey
            };

            RequestTracer reqTracer = RuntimePlatformUtils.GetRequestTracer();
            if (reqTracer != null) {
                logDef.RequestKey = reqTracer.RequestKey;
            }

            logDef.Write();
            return logDef.Id;
        }
    }
}
